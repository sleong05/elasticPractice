input {
  # 1️⃣ HTTP JSON input (easy for testing or apps)
  http {
    port => 31311
    codec => json
  }

  # 2️⃣ Plain TCP text input (for simple messages)
  tcp {
    port => 31312
    codec => line
  }
}

filter {
  # add timestamp from JSON if provided
  if [timestamp] {
    date {
      match => ["timestamp", "ISO8601", "yyyy-MM-dd HH:mm:ss"]
      target => "@timestamp"
    }
  }

  # Optional: if message field contains JSON text, parse it
  if [message] and [message] =~ "{" {
    json {
      source => "message"
      target => "parsed"
      skip_on_invalid_json => true
    }
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "logstash-%{+YYYY.MM.dd}"
    ilm_enabled => false
  }

  stdout { codec => rubydebug }
}
